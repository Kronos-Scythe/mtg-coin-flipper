<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>MTG Coin Flip Helper</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="robots" content="noindex, nofollow">
    <meta name="googlebot" content="noindex, nofollow">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Eczar&family=Roboto&family=Share+Tech+Mono&display=swap" rel="stylesheet">

    <style id="compiled-css" type="text/css">
      html {
        font-size: 16px;
        font-family: 'Roboto', sans-serif;
      }

      h1, h2 {
        font-family: 'Eczar', serif;
      }

      label {
        display: block;
        margin-bottom: 1rem;
      }

      fieldset { 
        padding-top: 1rem;
        margin-bottom: 1rem;
      }

      button {
        margin-bottom: 1rem;
      }

      div {
        max-width: 26rem;
        margin: auto;
      }

      small {
        display: block;
        font-size: 50%;
      }

      input[type=number] {
        width: 2.5rem;
      }

      input[type=checkbox] { 
        vertical-align: middle;
      }

      input, button {
        font-size: 100%;
      }

      input.wide {
        width: 5rem;
      }

      code {
        overflow-wrap: break-word;
        max-height: 10rem;
        overflow-y: auto;
        display: block;
        font-family: 'Share Tech Mono', monospace;
      }
    </style>
  </head>

  <body>
    <div>
      <h1>Coin flip helper</h1>
      <form id="frenetic_solver">
        <h2>
          Resolving Frenetic Efreet
        </h2>
        <label>
          Krark Thumbs:
          <input type="number" inputmode="numeric" id="frenetic_krark_thumb_count" value="0" />
        </label>

        <label>
          Number of flips:
          <input class="wide" type="number" id="frenetic_flips_count" value="1" />
        </label>
        <label>Verbose mode: <input type="checkbox" id="frenetic_verbose" /></label>
        <button>
          Go!
        </button>
        <label>
          Number of wins:
          <span id="frenetic_wins_count"></span>
        </label>
      </form>
      <hr>
      <form id="okaun_solver">
        <h2>
          Resolving Okaun // Zndrsplt
          <small>and other effects that flip till you fail...</small>
        </h2>
        <label>
          Krark Thumbs:
          <input type="number" inputmode="numeric" id="okaun_krark_thumb_count" value="0" />
        </label>
        <fieldset>
          <legend>"Smart" features</legend>
          <label>
            Attempt stop after <input type="number" inputmode="numeric" id="okaun_max" value="10" /> wins:
            <input type="checkbox" id="okaun_stop" value="1" />
          </label>
        </fieldset>
        <label>Verbose mode: <input type="checkbox" id="okaun_verbose" /></label>
        <button>
          Go!
        </button>
        <label>
          Okaun Power multiplier:
          <span id="okaun_multi"></span>
        </label>
        <label>
          Number of wins (cards drawn):
          <span id="okaun_wins_count"></span>
        </label>
      </form>
      <hr>
      <form id="krark_solver">
        <h2>
          Resolving Krark // Sakashima
        </h2>
        <label>
          Krark Thumbs:
          <input type="number" inputmode="numeric" id="krark_thumb_count" value="0" />
        </label>
        <label>
          Krark copies:
          <input type="number" inputmode="numeric" id="krarks_count" value="1" />
        </label>
        <fieldset>
          <legend>"Smart" features</legend>
          <label>
            Attempt return to hand BEFORE successful copy:
            <input type="checkbox" id="krark_before" value="1" />
          </label>
          <label>
            Attempt return to hand AFTER successful copy:
            <input type="checkbox" id="krark_after" value="1" />
          </label>
        </fieldset>
        <label>Verbose mode: <input type="checkbox" id="krark_verbose" /></label>
        <button>
          Go!
        </button>
        <label>
          Original spell goes to hand?:
          <span id="krark_hand"></span>
        </label>
        <label>
          Number of spell copies:
          <span id="krark_wins_count"></span>
        </label>
      </form>
    </div>
    <script type="text/javascript">
      //<![CDATA[
      document.getElementById('frenetic_solver').onsubmit = function (e) {
        e.preventDefault();
        e.stopPropagation();
        var k = Math.pow(2, parseInt(document.getElementById('frenetic_krark_thumb_count').value));
        var f = parseInt(document.getElementById('frenetic_flips_count').value);
        var w = 0;
        var verbose = document.getElementById('frenetic_verbose').checked;
        var output = [];
        for (var i = 0; i < f; i++) {
          for (var j = 0; j < k; j++) {
            if (Math.random() < 0.5) {
              w = w + 1;
              if (verbose) {
                output.push('H');
              }
              break;
            }
            if (verbose) {
              output.push('T');
            }
          }
          if (verbose && i != (f - 1)) {
            output.push(' | ');
          }
        }
        if (verbose) {
          document.getElementById('frenetic_wins_count').innerHTML = (
            w.toString() + '<br/>' +
            '<code>' + output.join('') + '</code>'
          );
        } else {
          document.getElementById('frenetic_wins_count').innerHTML = w.toString();
        }
      }

      document.getElementById('okaun_solver').onsubmit = function (e) {
        e.preventDefault();
        e.stopPropagation();
        var t = parseInt(document.getElementById('okaun_krark_thumb_count').value);
        var max = parseInt(document.getElementById('okaun_max').value);
        var stop_at_max = document.getElementById('okaun_stop').checked;
        if (t >= 5) {
          document.getElementById('okaun_wins_count').innerHTML = "This is going to take a while to compute... (hint: it's going to be a very large number)";
          document.getElementById('okaun_multi').innerHTML = "Infinity";
        }
        setTimeout(function () {
          var verbose = document.getElementById('okaun_verbose').checked;
          var output = [];
          var k = Math.pow(2, t);
          var winning = true;
          var w = 0;
          while (winning) {
            var pre = w;
            for (var j = 0; j < k; j++) {
              if (stop_at_max && w >= max) {
                if (Math.random() < 0.5) {
                  if (verbose) {
                    output.push('T');
                  }
                  break;
                } else {
                  if (j == (k - 1)) {
                    w = w + 1;
                  }
                  if (verbose) {
                    output.push('H');
                  }
                  continue;
                }
              }
              if (Math.random() < 0.5) {
                w = w + 1;
                if (verbose) {
                  output.push('H');
                }
                break;
              }
              if (verbose) {
                output.push('T');
              }
            }
            if (pre == w) {
              winning = false;
            }
            if (verbose && winning) {
              output.push(' | ');
            }
          }
          document.getElementById('okaun_multi').innerHTML = Math.pow(2, w);

          if (verbose) {
            document.getElementById('okaun_wins_count').innerHTML = (
              w.toString() + '<br/>' +
              '<code>' + output.join('') + '</code>'
            );
          } else {
            document.getElementById('okaun_wins_count').innerHTML = w.toString();
          }
        }, 100)
      }

      document.getElementById('krark_solver').onsubmit = function (e) {
        e.preventDefault();
        e.stopPropagation();
        var k = Math.pow(2, parseInt(document.getElementById('krark_thumb_count').value));
        var s = parseInt(document.getElementById('krarks_count').value);
        var returned_to_hand = false;
        var successful_copy = false;
        var attempt_before = document.getElementById('krark_before').checked
        var attempt_after = document.getElementById('krark_after').checked
        var verbose = document.getElementById('okaun_verbose').checked;
        var output = [];

        var w = 0;
        for (var i = 0; i < s; i++) {
          for (var j = 0; j < k; j++) {
            if (returned_to_hand == false) {
              if (successful_copy == false) {
                if (attempt_before) {
                  if (Math.random() < 0.5) {
                    returned_to_hand = true;
                    if (verbose) {
                      output.push('T');
                    }
                    break;
                  } else {
                    if (j == (k - 1)) {
                      w = w + 1;
                    }
                    if (verbose) {
                      output.push('H');
                    }
                    continue;
                  }
                }
              } else {
                if (attempt_after) {
                  if (Math.random() < 0.5) {
                    returned_to_hand = true;
                    if (verbose) {
                      output.push('T');
                    }
                    break;
                  } else {
                    if (j == (k - 1)) {
                      w = w + 1;
                    }
                    if (verbose) {
                      output.push('H');
                    }
                    continue;
                  }
                }
              }
            }
            if (Math.random() < 0.5) {
              successful_copy = true
              w = w + 1;
              if (verbose) {
                output.push('H');
              }
              break;
            }
            if (verbose) {
              output.push('T');
            }
          }
          if (verbose && i != (s - 1)) {
            output.push(' | ');
          }
        }
        document.getElementById('krark_hand').innerHTML = (w < s) ? 'Yes' : 'No';

        if (verbose) {
          document.getElementById('krark_wins_count').innerHTML = (
            w.toString() + '<br/>' +
            '<code>' + output.join('') + '</code>'
          );
        } else {
          document.getElementById('krark_wins_count').innerHTML = w.toString();
        }
      }
      //]]>
    </script>
  </body>
</html>